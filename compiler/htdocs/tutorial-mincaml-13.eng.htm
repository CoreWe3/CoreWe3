<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=ascii">
<link rel=Edit-Time-Data href="./tutorial-mincaml.files/editdata.mso">
<link rel="stylesheet" href="sh.css" type="text/css">
<title>A Crash Course for the MinCaml Compiler</title>
</head>
<body bgcolor="#FFFFFF" link=blue vlink=purple class="Normal">
<div>
  <h3>Inline Expansion (<tt>inline.ml</tt>)</h3>
  <p>The next optimization is the most effective one: <em>inline expansion</em>. It replaces calls to small functions with their bodies. MinCaml implements it in function <a target="srcview"
href="min-caml.html#inline_g"><tt>Inline.g</tt></a>.</p>
  <p>First, in the case of function definition <a target="srcview"
href="min-caml.html#inline_letrec"><tt>let rec f x1 ... xn = e in </tt>...</a>, we compute the size of body <tt>e</tt> of the function <tt>f</tt> by <tt>Inline.size</tt>. If this size is less than integer reference <a target="srcview"
href="min-caml.html#inline_threshold"><tt>Inline.threshold</tt></a>, we add the correspondence from the function name <tt>f</tt> to formal arguments <tt>x1, ..., xn</tt> and body <tt>e</tt> in the mapping <tt>env</tt>. Then, in the case of function call <a target="srcview"
href="min-caml.html#inline_app"><tt>f y1 ... yn</tt></a>, we look up the formal arguments <tt>x1, ..., xn</tt> of <tt>f</tt> its body <tt>e</tt> from the mapping <tt>env</tt>, and return <tt>e</tt> with <tt>x1, ..., xn</tt> replaced by <tt>y1, ..., yn</tt>.</p>
  <p>However, since inlined expressions are copies of function bodies, their variables may be duplicated and therefore must be &alpha;-converted again. Accidentally or not, the previous process of &quot;replacing formal arguments with actual arguments&quot; can be done by <tt>Alpha.g</tt> together with &alpha;-conversion, just by using the correspondence from <tt>x1</tt>, ..., <tt>xn</tt> to <tt>y1</tt>, ..., <tt>yn</tt> (instead of an empty mapping) as the initial mapping <tt>env</tt>.</p>
  <p><a
href="tutorial-mincaml-14.eng.htm">Next</a></p>
</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1484933-2";
urchinTracker();
</script>
</body>
</html>
